# claude.local.md â€” Della (MSALGANIK group)

Reference configuration for researchers in the MSALGANIK group on Princeton's Della cluster.

To use: copy this file to `claude.local.md` and replace `jc0425` with your HPC username and fill in the remaining placeholders.

---

## HPC Environment

- **Cluster**: Della (Princeton Research Computing)
- **Documentation**: https://researchcomputing.princeton.edu/systems/della
- **Username**: `jc0425`
- **Group**: `MSALGANIK`
- **Home directory**: `/home/jc0425`
- **Scratch directory**: `/scratch/gpfs/MSALGANIK/jc0425`
- **Working directory**: `/scratch/gpfs/MSALGANIK/jc0425/GitHub/cruijff_kit`

### Shared Resources

- **Models directory**: `/scratch/gpfs/MSALGANIK/pretrained-llms`

## SLURM Defaults

- **Account**: `msalganik`
- **Partition**: (none)
- **Constraint**: `gpu80`
- **Default time**: `0:59:00`
- **Default GPUs**: `1`
- **Default conda environment**: `cruijff`

## Module System

```bash
module load anaconda3/2025.6
```

## Conda Environment Setup

**Environment name**: `cruijff`

**Activation**:
```bash
module load anaconda3/2025.6
conda activate cruijff
```

**Installation**: Create a conda environment and run `make install` (or `make install-dev` for development) from the cruijff_kit repo root. See the Makefile for details.

## GitHub Configuration

- **Username**: `<your_github_username>`
- **cruijff_kit project number**: `3`

**Adding issues to project**:
```bash
gh project item-add 3 --owner niznik-dev --url https://github.com/niznik-dev/cruijff_kit/issues/<issue_number>
```

## Weights & Biases

- **Entity**: `<your_wandb_entity>`
- **Default project**: `cruijff_kit`

## Common Paths

### Pretrained Models
- **Location**: `/scratch/gpfs/MSALGANIK/pretrained-llms/`
- **Available models**:
  - `Llama-3.2-1B-Instruct`
  - `Llama-3.2-3B-Instruct`

### Working Directories
- **Experiments**: `/scratch/gpfs/MSALGANIK/jc0425/ck-experiments/`
- **Sanity checks**: `/scratch/gpfs/MSALGANIK/jc0425/ck-sanity-checks/`
- **Outputs**: `/scratch/gpfs/MSALGANIK/jc0425/ck-outputs/`

### Data
- **Input data**: `/scratch/gpfs/MSALGANIK/jc0425/data/`

## Quick Commands

### Fine-tuning (manual)
```bash
# From your run directory (e.g., ck-experiments/<experiment_name>/<run_name>/)
python /scratch/gpfs/MSALGANIK/jc0425/GitHub/cruijff_kit/tools/torchtune/setup_finetune.py \
  --config_file setup_finetune.yaml

# Submit job
sbatch finetune.slurm
```

### Evaluation (manual)
```bash
# Setup inspect for a fine-tuned checkpoint
python /scratch/gpfs/MSALGANIK/jc0425/GitHub/cruijff_kit/tools/inspect/setup_inspect.py \
  --finetune_epoch_dir /path/to/ck-outputs/<experiment>/<run>/epoch_N/

# Optionally include base model for comparison
python /scratch/gpfs/MSALGANIK/jc0425/GitHub/cruijff_kit/tools/inspect/setup_inspect.py \
  --base_model_dir /scratch/gpfs/MSALGANIK/pretrained-llms/Llama-3.2-1B-Instruct/ \
  --finetune_epoch_dir /path/to/ck-outputs/<experiment>/<run>/epoch_N/

# Submit evaluation job
sbatch <task>_epoch<N>.slurm

# View results interactively (on login node)
inspect view --port=$(get_free_port)
```

### Job Management
```bash
# View all your jobs
squeue -u jc0425

# View recent job history
sacct -u jc0425 -S today --format=JobID,JobName,State,ExitCode,Elapsed,MaxRSS,End -X

# Cancel a job
scancel <job_id>

# Cancel all your jobs
scancel -u jc0425
```
